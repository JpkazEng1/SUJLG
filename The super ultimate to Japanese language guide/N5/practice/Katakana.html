<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Katakana Typing Practice</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #98c1ff;
      color: #000000;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      transition: background-color 0.3s, color 0.3s;
    }

    .game-container {
      text-align: center;
      background-color: #f0f0f0;
      padding: 50px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      width: 300px;
      transition: background-color 0.3s;
    }

    .title {
      font-size: 32px;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .button {
      display: inline-block;
      background-color: #4CAF50;
      color: white;
      padding: 10px 20px;
      margin: 10px;
      text-align: center;
      text-decoration: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s, transform 0.2s;
    }

    .button:hover {
      background-color: #45a049;
      transform: scale(1.05);
    }

    .restart-button {
      background-color: #f44336;
    }

    .restart-button:hover {
      background-color: #e53935;
    }

    body.dark-mode {
      background-color: #121212;
      color: #ffffff;
    }

    body.dark-mode .game-container {
      background-color: #1f1f1f;
    }

    .hiragana {
      font-size: 50px;
      margin-bottom: 20px;
    }

    .input-field {
      padding: 10px;
      font-size: 27px;
      width: 100%;
      margin-bottom: 20px;
      text-align: center;
    }

    .result {
      font-size: 20px;
      font-weight: bold;
    }

    .remaining-count {
      font-size: 18px;
      margin-top: 10px;
    }

    .final-result {
      font-size: 24px;
      margin-top: 20px;
      color: #4CAF50;
    }

    .explanation-button {
      background-color: #e68a00; /* Set the background color to orange */
      color: white; /* Adjust text color for better contrast */
      transition: background-color 0.3s, transform 0.2s;
    }

    .explanation-button:hover {
      background-color: #a35f00; /* Slightly darker shade for hover effect */
      transform: scale(1.05);
    }
  </style>
</head>
<body>
  <div class="game-container">
    <div class="title">Katakana Typing Practice</div>
    <div id="hiragana" class="hiragana"></div>
    <input type="text" id="userInput" class="input-field" placeholder="Enter reading here">
    <div id="result" class="result"></div>
    <div id="remainingCount" class="remaining-count"></div>
    <div id="finalResult" class="final-result"></div>
    <a href="Katakana_explanation.html" class="button explanation-button">Explanation</a>
    <!-- Restart Button -->
    <button id="restartButton" class="button restart-button">Restart</button>
    <a href="practiceN5.html" class="button">Return</a>
  </div>

  <script>
    const hiraganaList = {
      ã‚¢: "a", ã‚¤: "i", ã‚¦: "u", ã‚¨: "e", ã‚ª: "o",
ã‚«: "ka", ã‚­: "ki", ã‚¯: "ku", ã‚±: "ke", ã‚³: "ko",
ã‚µ: "sa", ã‚·: "si", ã‚¹: "su", ã‚»: "se", ã‚½: "so",
ã‚¿: "ta", ãƒ: "ti", ãƒ„: "tu", ãƒ†: "te", ãƒˆ: "to",
ãƒŠ: "na", ãƒ‹: "ni", ãƒŒ: "nu", ãƒ: "ne", ãƒ: "no",
ãƒ: "ha", ãƒ’: "hi", ãƒ•: "fu", ãƒ˜: "he", ãƒ›: "ho",
ãƒ: "ma", ãƒŸ: "mi", ãƒ : "mu", ãƒ¡: "me", ãƒ¢: "mo",
ãƒ¤: "ya", ãƒ¦: "yu", ãƒ¨: "yo",
ãƒ©: "ra", ãƒª: "ri", ãƒ«: "ru", ãƒ¬: "re", ãƒ­: "ro",
ãƒ¯: "wa", ãƒ²: "wo", ãƒ³: "nn",
ã‚¬: "ga", ã‚®: "gi", ã‚°: "gu", ã‚²: "ge", ã‚´: "go",
ã‚¶: "za", ã‚¸: "zi", ã‚º: "zu", ã‚¼: "ze", ã‚¾: "zo",
ãƒ€: "da", ãƒ‚: "di", ãƒ…: "du", ãƒ‡: "de", ãƒ‰: "do",
ãƒ: "ba", ãƒ“: "bi", ãƒ–: "bu", ãƒ™: "be", ãƒœ: "bo",
ãƒ‘: "pa", ãƒ”: "pi", ãƒ—: "pu", ãƒš: "pe", ãƒ: "po",
ã‚­ãƒ£: "kya", ã‚­ãƒ¥: "kyu", ã‚­ãƒ§: "kyo",
ã‚·ãƒ£: "sha", ã‚·ãƒ¥: "shu", ã‚·ãƒ§: "sho",
ãƒãƒ£: "cha", ãƒãƒ¥: "chu", ãƒãƒ§: "cho",
ãƒ‹ãƒ£: "nya", ãƒ‹ãƒ¥: "nyu", ãƒ‹ãƒ§: "nyo",
ãƒ’ãƒ£: "hya", ãƒ’ãƒ¥: "hyu", ãƒ’ãƒ§: "hyo",
ãƒŸãƒ£: "mya", ãƒŸãƒ¥: "myu", ãƒŸãƒ§: "myo",
ãƒªãƒ£: "rya", ãƒªãƒ¥: "ryu", ãƒªãƒ§: "ryo",
ã‚®ãƒ£: "gya", ã‚®ãƒ¥: "gyu", ã‚®ãƒ§: "gyo",
ã‚¸ãƒ£: "ja", ã‚¸ãƒ¥: "ju", ã‚¸ãƒ§: "jo",
ãƒ“ãƒ£: "bya", ãƒ“ãƒ¥: "byu", ãƒ“ãƒ§: "byo",
ãƒ”ãƒ£: "pya", ãƒ”ãƒ¥: "pyu", ãƒ”ãƒ§: "pyo"
    };

    let currentHiragana = "";
    let correctAnswer = "";
    let correctCount = 0;
    let wrongCount = 0;
    const totalHiragana = Object.keys(hiraganaList).length;

    let wrongHiragana = [];
    let allAnswered = new Set();  // è¿½åŠ : ã™ã¹ã¦å‡ºé¡Œã•ã‚ŒãŸã²ã‚‰ãŒãªã‚’è¨˜éŒ²

    function getRandomHiragana() {
      // å‡ºé¡Œã•ã‚Œã¦ã„ãªã„ã²ã‚‰ãŒãªã‚’å–å¾—ã™ã‚‹
      const unansweredHiragana = Object.keys(hiraganaList).filter(hiragana => !allAnswered.has(hiragana));
      
      // ã™ã¹ã¦ã®ã²ã‚‰ãŒãªãŒå‡ºé¡Œã•ã‚ŒãŸå ´åˆã¯ã€é–“é•ãˆãŸã²ã‚‰ãŒãªã‚’å‡ºé¡Œ
      if (unansweredHiragana.length === 0) {
        return wrongHiragana[Math.floor(Math.random() * wrongHiragana.length)];
      }
      
      // æœªå‡ºé¡Œã®ã²ã‚‰ãŒãªã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«é¸ã¶
      return unansweredHiragana[Math.floor(Math.random() * unansweredHiragana.length)];
    }

    function displayHiragana() {
      currentHiragana = getRandomHiragana();
      correctAnswer = hiraganaList[currentHiragana];
      document.getElementById("hiragana").innerText = currentHiragana;
      document.getElementById("userInput").value = '';
      document.getElementById("result").innerText = '';
      updateRemainingCount();
    }

    function checkAnswer() {
      const userAnswer = document.getElementById("userInput").value.trim().toLowerCase();
      if (userAnswer === correctAnswer) {
        document.getElementById("result").innerText = "Correct! ğŸ‰";
        document.getElementById("result").style.color = "green";
        correctCount++;

        // æ­£è§£ã—ãŸã²ã‚‰ãŒãªã‚’è¨˜éŒ²
        allAnswered.add(currentHiragana);

        // é–“é•ãˆãŸã²ã‚‰ãŒãªã‹ã‚‰å‰Šé™¤
        const index = wrongHiragana.indexOf(currentHiragana);
        if (index !== -1) {
          wrongHiragana.splice(index, 1);
        }
      } else {
        document.getElementById("result").innerText = "Try again! âŒ";
        document.getElementById("result").style.color = "red";
        wrongCount++;

        if (!wrongHiragana.includes(currentHiragana)) {
          wrongHiragana.push(currentHiragana);
        }
      }
      setTimeout(displayHiragana, 1000); // 1ç§’å¾Œã«æ¬¡ã®å•é¡Œã‚’è¡¨ç¤º
    }

    function updateRemainingCount() {
      const remaining = totalHiragana - correctCount;
      document.getElementById("remainingCount").innerText = `Remaining: ${remaining} Katakana`;

      // ã™ã¹ã¦ã®ã²ã‚‰ãŒãªã‚’æ­£è§£ã—ãŸå ´åˆ
      if (remaining <= 0) {
        document.getElementById("remainingCount").style.display = 'none';  // æ®‹ã‚Šå•é¡Œæ•°ã‚’éè¡¨ç¤º
        document.getElementById("finalResult").innerText = `You finished the game! ğŸ‰`;
        document.getElementById("finalResult").style.color = correctCount === totalHiragana ? 'green' : 'red';
        document.getElementById("result").style.display = 'none'; // çµæœéè¡¨ç¤º
        document.getElementById("userInput").disabled = true; // å…¥åŠ›æ¬„ã‚’ç„¡åŠ¹ã«ã™ã‚‹
      }
    }

    function restartGame() {
      // Reset the game state
      correctCount = 0;
      wrongCount = 0;
      wrongHiragana = [];
      allAnswered.clear();
      document.getElementById("finalResult").innerText = "";
      document.getElementById("remainingCount").style.display = 'block';
      document.getElementById("result").style.display = 'block';
      document.getElementById("userInput").disabled = false;
      displayHiragana();
    }

    // Initialize the game
    displayHiragana();

    document.getElementById("userInput").addEventListener("keydown", function(event) {
      if (event.key === "Enter") {
        checkAnswer();
      }
    });

    // Add event listener to the restart button
    document.getElementById("restartButton").addEventListener("click", restartGame);

    if (localStorage.getItem('darkMode') === 'true') {
      document.body.classList.add('dark-mode');
    }
  </script>
</body>
</html>
