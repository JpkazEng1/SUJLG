<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hiragana Pronunciation Practice</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #98c1ff;
      color: #000000;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      transition: background-color 0.3s, color 0.3s;
    }

    .game-container {
      text-align: center;
      background-color: #f0f0f0;
      padding: 50px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      width: 300px;
      transition: background-color 0.3s;
    }

    .title {
      font-size: 32px;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .button {
      display: inline-block;
      background-color: #4CAF50;
      color: white;
      padding: 10px 20px;
      margin: 10px;
      text-align: center;
      text-decoration: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
    }

    .button:hover {
      background-color: #45a049;
    }

    .restart-button {
      background-color: #f44336;
    }

    .restart-button:hover {
      background-color: #e53935;
    }

    body.dark-mode {
      background-color: #121212;
      color: #ffffff;
    }

    body.dark-mode .game-container {
      background-color: #1f1f1f;
    }

    .hiragana {
      font-size: 50px;
      margin-bottom: 20px;
    }

    .english {
      font-size: 0.5em; 
      color: #555; 
    }

    .input-field {
      padding: 10px;
      font-size: 27px;
      width: 100%;
      margin-bottom: 20px;
      text-align: center;
    }

    .result {
      font-size: 20px;
      font-weight: bold;
    }

    .remaining-count {
      font-size: 18px;
      margin-top: 10px;
    }

    .final-result {
      font-size: 24px;
      margin-top: 20px;
      color: #4CAF50;
    }
  </style>
</head>
<body>
  <div class="game-container">
    <div class="title">Katakana Pronunciation Practice</div>
    <div class="instruction">Press the voice recognition button, speak, and then wait a few seconds.</div>
    <div id="hiragana" class="hiragana"></div>
    <div id="audio-controls">
      <button id="startRecognition" class="button">Start Voice Recognition</button>
    </div>
    <input type="text" id="userInput" class="input-field" placeholder="Enter reading here (or try to say it!)">
    <div id="result" class="result"></div>
    <div id="remainingCount" class="remaining-count"></div>
    <div id="finalResult" class="final-result"></div>
    <a href="Katakana_explanation.html" class="button explanation-button">Explanation</a>
    <button id="restartButton" class="button restart-button">Restart</button>
    <a href="../practiceN5.html" class="button">Return</a>
  </div>

  <style>
    .explanation-button {
      background-color: #e68a00; 
      color: white; 
    }

    .explanation-button:hover {
      background-color: #a35f00; 
    }
  </style>

<script>
  const hiraganaList = {
    ã‚¢ãƒ¡ãƒªã‚«: { jp: "ã‚¢ãƒ¡ãƒªã‚«", en: "America" }, ã‚¤ã‚®ãƒªã‚¹: { jp: "ã‚¤ã‚®ãƒªã‚¹", en: "England" }, ã‚¦ã‚¤ãƒ«ã‚¹: { jp: "ã‚¦ã‚¤ãƒ«ã‚¹", en: "Virus" }, ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼: { jp: "ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼", en: "Elevator" },  
ã‚ªãƒ«ã‚´ãƒ¼ãƒ«: { jp: "ã‚ªãƒ«ã‚´ãƒ¼ãƒ«", en: "Music Box" }, ã‚«ãƒ¡ãƒ¬ã‚ªãƒ³: { jp: "ã‚«ãƒ¡ãƒ¬ã‚ªãƒ³", en: "Chameleon" }, ã‚­ãƒ„ãƒ: { jp: "ã‚­ãƒ„ãƒ", en: "Fox" }, ã‚¯ãƒ©ã‚²: { jp: "ã‚¯ãƒ©ã‚²", en: "Jellyfish" },  
ã‚±ãƒãƒ£ãƒƒãƒ—: { jp: "ã‚±ãƒãƒ£ãƒƒãƒ—", en: "Ketchup" }, ã‚³ã‚¹ãƒ¢ã‚¹: { jp: "ã‚³ã‚¹ãƒ¢ã‚¹", en: "Cosmos" }, ã‚µãƒ•ã‚¡ã‚¤ã‚¢: { jp: "ã‚µãƒ•ã‚¡ã‚¤ã‚¢", en: "Sapphire" }, ã‚·ãƒ³ãƒãƒ«: { jp: "ã‚·ãƒ³ãƒãƒ«", en: "Cymbal" },  
ã‚¹ã‚«ãƒ¼ãƒ•: { jp: "ã‚¹ã‚«ãƒ¼ãƒ•", en: "Scarf" }, ã‚»ãƒ­ãƒª: { jp: "ã‚»ãƒ­ãƒª", en: "Celery" }, ã‚½ãƒ•ãƒˆã‚¯ãƒªãƒ¼ãƒ : { jp: "ã‚½ãƒ•ãƒˆã‚¯ãƒªãƒ¼ãƒ ", en: "Ice cream" }, ã‚¿ã‚³ã‚¹: { jp: "ã‚¿ã‚³ã‚¹", en: "Tacos" },  

ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆ: { jp: "ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆ", en: "Chocolate" }, ãƒ„ãƒ¼ãƒ« : { jp: "ãƒ„ãƒ¼ãƒ«", en: "Tool" }, ãƒ†ãƒ¬ãƒ“: { jp: "ãƒ†ãƒ¬ãƒ“", en: "Television" }, ãƒˆãƒ©ãƒ³ãƒšãƒƒãƒˆ: { jp: "ãƒˆãƒ©ãƒ³ãƒšãƒƒãƒˆ", en: "Trumpet" },  
ãƒŠãƒãƒªã‚¿ãƒ³: { jp: "ãƒŠãƒãƒªã‚¿ãƒ³", en: "Neapolitan" }, ãƒ‹ãƒƒã‚±ãƒ«: { jp: "ãƒ‹ãƒƒã‚±ãƒ«", en: "Nickel" }, ãƒŒãƒ¼ãƒ‰ãƒ«: { jp: "ãƒŒãƒ¼ãƒ‰ãƒ«", en: "Noodle" }, ãƒã‚¬ãƒ†ã‚£ãƒ–: { jp: "ãƒã‚¬ãƒ†ã‚£ãƒ–", en: "Negative" },  
ãƒŽãƒ¼ãƒˆ: { jp: "ãƒŽãƒ¼ãƒˆ", en: "Notebook" }, ãƒãƒŠãƒ ã‚°ãƒª: { jp: "ãƒãƒŠãƒ ã‚°ãƒª", en: "Flower Beetle" }, ãƒ’ãƒ¼ãƒ­ãƒ¼: { jp: "ãƒ’ãƒ¼ãƒ­ãƒ¼", en: "Hero" }, ãƒ•ãƒ©ã‚¤ãƒ‘ãƒ³: { jp: "ãƒ•ãƒ©ã‚¤ãƒ‘ãƒ³", en: "Frying pan" },  
ãƒ˜ãƒªã‚³ãƒ—ã‚¿ãƒ¼: { jp: "ãƒ˜ãƒªã‚³ãƒ—ã‚¿ãƒ¼", en: "Helicopter" }, ãƒ›ãƒ†ãƒ«: { jp: "ãƒ›ãƒ†ãƒ«", en: "Hotel" }, ãƒžã‚·ãƒ¥ãƒžãƒ­: { jp: "ãƒžã‚·ãƒ¥ãƒžãƒ­", en: "Marshmallow" }, ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°: { jp: "ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°", en: "Meeting" },  

ãƒ ãƒ¼ãƒ‰: { jp: "ãƒ ãƒ¼ãƒ‰", en: "Mood" }, ãƒ¡ãƒ­ãƒ³ãƒ‘ãƒ³: { jp: "ãƒ¡ãƒ­ãƒ³ãƒ‘ãƒ³", en: "Melon Bread" }, ãƒ¢ãƒŽãƒ¬ãƒ¼ãƒ«: { jp: "ãƒ¢ãƒŽãƒ¬ãƒ¼ãƒ«", en: "Monorail" },  ãƒ¤ã‚¯ãƒ«ãƒˆ: { jp: "ãƒ¤ã‚¯ãƒ«ãƒˆ", en: "Yakult" },  
ãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ³: { jp: "ãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ³", en: "Unicorn" }, ãƒ¨ãƒƒãƒˆ: { jp: "ãƒ¨ãƒƒãƒˆ", en: "Yacht" }, ãƒ©ã‚ºãƒ™ãƒªãƒ¼: { jp: "ãƒ©ã‚ºãƒ™ãƒªãƒ¼", en: "Raspberry" }, ãƒªã‚¹: { jp: "ãƒªã‚¹", en: "Squirrel" },  
ãƒ«ãƒ“ãƒ¼: { jp: "ãƒ«ãƒ“ãƒ¼", en: "Ruby" }, ãƒ¬ãƒ¢ãƒ³: { jp: "ãƒ¬ãƒ¢ãƒ³", en: "Lemon" }, ãƒ­ã‚±ãƒƒãƒˆ: { jp: "ãƒ­ã‚±ãƒƒãƒˆ", en: "Rocket" }, ãƒ¯ãƒ‹: { jp: "ãƒ¯ãƒ‹", en: "Crocodile" },  
ã‚ªã‚¿ã‚¯: { jp: "ã‚ªã‚¿ã‚¯", en: "Otaku" }, ã‚¬ã‚½ãƒªãƒ³: { jp: "ã‚¬ã‚½ãƒªãƒ³", en: "Gasoline" }, ã‚®ã‚¿ãƒ¼: { jp: "ã‚®ã‚¿ãƒ¼", en: "Guitar" },  

ã‚°ãƒŸ: { jp: "ã‚°ãƒŸ", en: "Gummy" }, ã‚²ãƒ¼ãƒˆ: { jp: "ã‚²ãƒ¼ãƒˆ", en: "Gate" }, ã‚´ãƒªãƒ©: { jp: "ã‚´ãƒªãƒ©", en: "Gorilla" }, ã‚¶ã‚¯ãƒ­: { jp: "ã‚¶ã‚¯ãƒ­", en: "Pomegranate" },  
ã‚¸ã‚°ã‚½ãƒ¼: { jp: "ã‚¸ã‚°ã‚½ãƒ¼", en: "Jigsaw" }, ã‚ºãƒœãƒ³: { jp: "ã‚ºãƒœãƒ³", en: "Pants" }, ã‚¼ãƒªãƒ¼: { jp: "ã‚¼ãƒªãƒ¼", en: "Jelly" }, ã‚¾ãƒ³ãƒ“: { jp: "ã‚¾ãƒ³ãƒ“", en: "Zombie" },  
ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰: { jp: "ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰", en: "Diamond" }, ã‚¸ãƒ§ãƒ¼ã‚¯: { jp: "ã‚¸ãƒ§ãƒ¼ã‚¯", en: "Joke" }, ãƒ‡ã‚¶ãƒ¼ãƒˆ: { jp: "ãƒ‡ã‚¶ãƒ¼ãƒˆ", en: "Dessert" }, ãƒ’ãƒ§ãƒ¼ãƒ‰ãƒ«: { jp: "ãƒ’ãƒ§ãƒ¼ãƒ‰ãƒ«", en: "Fedor" },  
ãƒ‰ãƒ©ã‚´ãƒ³: { jp: "ãƒ‰ãƒ©ã‚´ãƒ³", en: "Dragon" }, ãƒãƒŠãƒŠ: { jp: "ãƒãƒŠãƒŠ", en: "Banana" }, ãƒ“ã‚¹ã‚±ãƒƒãƒˆ: { jp: "ãƒ“ã‚¹ã‚±ãƒƒãƒˆ", en: "Biscuit" }, ãƒ–ãƒ«ãƒ‰ãƒƒã‚°: { jp: "ãƒ–ãƒ«ãƒ‰ãƒƒã‚°", en: "Bulldog" },  

ãƒ™ãƒ¼ã‚³ãƒ³: { jp: "ãƒ™ãƒ¼ã‚³ãƒ³", en: "Bacon" }, ãƒœãƒ¼ãƒªãƒ³ã‚°: { jp: "ãƒœãƒ¼ãƒªãƒ³ã‚°", en: "Bowling" }, ãƒ‘ãƒ³ã‚±ãƒ¼ã‚­: { jp: "ãƒ‘ãƒ³ã‚±ãƒ¼ã‚­", en: "Pancake" }, ãƒ”ãƒ¼ãƒžãƒ³: { jp: "ãƒ”ãƒ¼ãƒžãƒ³", en: "Bell Pepper" },  
ãƒ—ãƒªãƒ³: { jp: "ãƒ—ãƒªãƒ³", en: "Pudding" }, ãƒšãƒ³ã‚®ãƒ³: { jp: "ãƒšãƒ³ã‚®ãƒ³", en: "Penguin" }, ãƒã‚¹ãƒˆ: { jp: "ãƒã‚¹ãƒˆ", en: "Post" }, ã‚­ãƒ£ãƒ™ãƒ„: { jp: "ã‚­ãƒ£ãƒ™ãƒ„", en: "Cabbage" },  
ã‚­ãƒ¥ãƒ¼ãƒˆ: { jp: "ã‚­ãƒ¥ãƒ¼ãƒˆ", en: "Cute" }, ã‚·ãƒ£ãƒ¼ãƒšãƒ³: { jp: "ã‚·ãƒ£ãƒ¼ãƒšãƒ³", en: "Pencil" }, ã‚·ãƒ¥ã‚¦ãƒžã‚¤: { jp: "ã‚·ãƒ¥ã‚¦ãƒžã‚¤", en: "Shumai" },  
ã‚·ãƒ§ã‚³ãƒ©: { jp: "ã‚·ãƒ§ã‚³ãƒ©", en: "Chocolat" }, ãƒãƒ£ãƒ¼ãƒãƒ³: { jp: "ãƒãƒ£ãƒ¼ãƒãƒ³", en: "Fried Rice" }, ãƒãƒ¥ãƒ¼ã‚¤ãƒ³ã‚¬ãƒ : { jp: "ãƒãƒ¥ãƒ¼ã‚¤ãƒ³ã‚¬ãƒ ", en: "Chewing gum" }, ãƒãƒ¼ã‚º: { jp: "ãƒãƒ¼ã‚º", en: "Cheese" },  

ãƒ‹ãƒ£ãƒ«ãƒ©ãƒˆãƒ›ãƒ†ãƒ—: { jp: "ãƒ‹ãƒ£ãƒ«ãƒ©ãƒˆãƒ›ãƒ†ãƒ—", en: "Nyarlathotep" }, ãƒ‹ãƒ¥ãƒ¼ãƒ¨ãƒ¼ã‚¯: { jp: "ãƒ‹ãƒ¥ãƒ¼ãƒ¨ãƒ¼ã‚¯", en: "New York" }, ãƒ‹ãƒ§ãƒ­ãƒ‹ãƒ§ãƒ­: { jp: "ãƒ‹ãƒ§ãƒ­ãƒ‹ãƒ§ãƒ­", en: "Slither" },   
ãƒ’ãƒ¥ãƒ¼ãƒžãƒ³: { jp: "ãƒ’ãƒ¥ãƒ¼ãƒžãƒ³", en: "Human" }, ãƒŸãƒ£ãƒ³ãƒžãƒ¼: { jp: "ãƒŸãƒ£ãƒ³ãƒžãƒ¼", en: "Myanmar" }, ãƒŸãƒ¥ãƒ¼ã‚¸ã‚«ãƒ«: { jp: "ãƒŸãƒ¥ãƒ¼ã‚¸ã‚«ãƒ«", en: "Musical" },  
ãƒŸãƒ¥ã‚¦ãƒ„ãƒ¼: { jp: "ãƒŸãƒ¥ã‚¦ãƒ„ãƒ¼", en: "Mewtwo" }, ãƒªãƒ£ãƒž: { jp: "ãƒªãƒ£ãƒž", en: "Llama" }, ãƒªãƒ¥ãƒƒã‚¯: { jp: "ãƒªãƒ¥ãƒƒã‚¯", en: "rucksack" }, ãƒªãƒ¥ãƒƒã‚¯ã‚µãƒƒã‚¯: { jp: "ãƒªãƒ¥ãƒƒã‚¯ã‚µãƒƒã‚¯", en: "backpack" },  
ã‚®ãƒ£ãƒ³ã‚°: { jp: "ã‚®ãƒ£ãƒ³ã‚°", en: "Gang" }, ã‚®ãƒ¥ãƒ³ãƒ‰ã‚¢ãƒ³: { jp: "ã‚®ãƒ¥ãƒ³ãƒ‰ã‚¢ãƒ³", en: "GÃ¼ndoÄŸan" }, ã‚¸ãƒ£ãƒ¼ãƒŠãƒªã‚¹ãƒˆ: { jp: "ã‚¸ãƒ£ãƒ¼ãƒŠãƒªã‚¹ãƒˆ", en: "Journalist" },  

ã‚¸ãƒ¥ãƒ¼ã‚¹: { jp: "ã‚¸ãƒ¥ãƒ¼ã‚¹", en: "Juice" }, ã‚¸ãƒ§ã‚®ãƒ³ã‚°: { jp: "ã‚¸ãƒ§ã‚®ãƒ³ã‚°", en: "Jogging" }, ãƒ“ãƒ£ã‚¯ã‚·ãƒ³: { jp: "ãƒ“ãƒ£ã‚¯ã‚·ãƒ³", en: "Cryptomeria" }, ãƒ“ãƒ¥ãƒƒãƒ•ã‚§: { jp: "ãƒ“ãƒ¥ãƒƒãƒ•ã‚§", en: "Buffet" },  
ãƒ“ãƒ§ãƒ¼ã‚¯: { jp: "ãƒ“ãƒ§ãƒ¼ã‚¯", en: "BjÃ¶rk" }, ãƒ”ãƒ¥ãƒ¼ãƒž: { jp: "ãƒ”ãƒ¥ãƒ¼ãƒž", en: "Puma" }, ãƒ”ãƒ§ãƒ³ã‚½ã‚¯: { jp: "ãƒ”ãƒ§ãƒ³ã‚½ã‚¯", en: "Byeon seok"},


  };

  let currentHiragana = "";
  let correctAnswer = "";
  let correctCount = 0;
  let wrongCount = 0;
  const totalHiragana = Object.keys(hiraganaList).length;

  let wrongHiragana = [];
  let allAnswered = new Set();

  function getRandomHiragana() {
    const unansweredHiragana = Object.keys(hiraganaList).filter(hiragana => !allAnswered.has(hiragana));
    if (unansweredHiragana.length === 0) {
      return wrongHiragana[Math.floor(Math.random() * wrongHiragana.length)];
    }
    return unansweredHiragana[Math.floor(Math.random() * unansweredHiragana.length)];
  }

  function displayHiragana() {
    currentHiragana = getRandomHiragana();
    correctAnswer = hiraganaList[currentHiragana];
    document.getElementById("hiragana").innerText = `${currentHiragana} (${hiraganaList[currentHiragana].en})`;
    document.getElementById("userInput").value = '';
    document.getElementById("result").innerText = '';
    updateRemainingCount();
  }

  function checkAnswer() {
  const userAnswer = document.getElementById("userInput").value.trim();
  if (correctAnswer.jp === userAnswer) {  
    correctCount++;
    document.getElementById("result").innerText = "Correct! ðŸŽ‰";
    document.getElementById("result").style.color = "green";
    allAnswered.add(currentHiragana);
    const index = wrongHiragana.indexOf(currentHiragana);
    if (index !== -1) {
      wrongHiragana.splice(index, 1);
    }
  } else {
    document.getElementById("result").innerText = "Try again! âŒ";
    document.getElementById("result").style.color = "red";
    wrongCount++;
    if (!wrongHiragana.includes(currentHiragana)) {
      wrongHiragana.push(currentHiragana);
    }
  }
  setTimeout(displayHiragana, 1000);  
}


  function startRecognition() {
    if (!("SpeechRecognition" in window || "webkitSpeechRecognition" in window)) {
      alert("Your browser does not support voice recognition.");
      return;
    }

    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = 'ja-JP';

    recognition.onresult = (event) => {
      const spokenText = event.results[0][0].transcript.trim();
      document.getElementById("userInput").value = spokenText;
      checkAnswer();
    };

    recognition.onerror = (event) => {
      console.error('Recognition error:', event.error);
      document.getElementById("result").innerText = "Recognition failed. Please try again.";
      document.getElementById("result").style.color = "red";
    };

    recognition.start();
  }

  function updateRemainingCount() {
    const remaining = totalHiragana - correctCount;
    document.getElementById("remainingCount").innerText = `Remaining: ${remaining} Katakana`;

    if (remaining <= 0) {
      document.getElementById("remainingCount").style.display = 'none';
      document.getElementById("finalResult").innerText = `You finished the game! ðŸŽ‰`;
      document.getElementById("finalResult").style.color = correctCount === totalHiragana ? 'green' : 'red';
      document.getElementById("result").style.display = 'none';
      document.getElementById("userInput").disabled = true;
    }
  }

  function restartGame() {
    correctCount = 0;
    wrongCount = 0;
    wrongHiragana = [];
    allAnswered.clear();
    document.getElementById("finalResult").innerText = "";
    document.getElementById("remainingCount").style.display = 'block';
    document.getElementById("result").style.display = 'block';
    document.getElementById("userInput").disabled = false;
    displayHiragana();
  }

  displayHiragana();

  document.getElementById("userInput").addEventListener("keydown", function(event) {
    if (event.key === "Enter") {
      checkAnswer();
    }
  });
  document.getElementById("startRecognition").addEventListener("click", startRecognition);
  document.getElementById("restartButton").addEventListener("click", restartGame);

  if (localStorage.getItem('darkMode') === 'true') {
    document.body.classList.add('dark-mode');
  }
</script>
</body>
</html>
