<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hiragana Pronunciation Practice</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #98c1ff;
      color: #000000;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      transition: background-color 0.3s, color 0.3s;
    }

    .game-container {
      text-align: center;
      background-color: #f0f0f0;
      padding: 50px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      width: 300px;
      transition: background-color 0.3s;
    }

    .title {
      font-size: 32px;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .button {
      display: inline-block;
      background-color: #4CAF50;
      color: white;
      padding: 10px 20px;
      margin: 10px;
      text-align: center;
      text-decoration: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
    }

    .button:hover {
      background-color: #45a049;
    }

    .restart-button {
      background-color: #f44336;
    }

    .restart-button:hover {
      background-color: #e53935;
    }

    body.dark-mode {
      background-color: #121212;
      color: #ffffff;
    }

    body.dark-mode .game-container {
      background-color: #1f1f1f;
    }

    .hiragana {
      font-size: 50px;
      margin-bottom: 20px;
    }

    .english {
      font-size: 0.5em; 
      color: #555; 
    }

    .input-field {
      padding: 10px;
      font-size: 27px;
      width: 100%;
      margin-bottom: 20px;
      text-align: center;
    }

    .result {
      font-size: 20px;
      font-weight: bold;
    }

    .remaining-count {
      font-size: 18px;
      margin-top: 10px;
    }

    .final-result {
      font-size: 24px;
      margin-top: 20px;
      color: #4CAF50;
    }
  </style>
</head>
<body>
  <div class="game-container">
    <div class="title">Hiragana Pronunciation Practice</div>
    <div id="hiragana" class="hiragana"></div>
    <div id="audio-controls">
      <button id="startRecognition" class="button">Start Voice Recognition</button>
    </div>
    <input type="text" id="userInput" class="input-field" placeholder="Enter reading here (or try to say it!)">
    <div id="result" class="result"></div>
    <div id="remainingCount" class="remaining-count"></div>
    <div id="finalResult" class="final-result"></div>
    <a href="Hiragana_explanation.html" class="button explanation-button">Explanation</a>
    <button id="restartButton" class="button restart-button">Restart</button>
    <a href="practiceN5.html" class="button">Return</a>
  </div>

  <style>
    .explanation-button {
      background-color: #e68a00; 
      color: white; 
    }

    .explanation-button:hover {
      background-color: #a35f00; 
    }
  </style>

<script>
  const hiraganaList = {
    ã‚ã‚: { jp: "é›¨", en: "Rain" }, ã„ã¬: { jp: "çŠ¬", en: "Dog" }, ã†ã¿: { jp: "æµ·", en: "Sea" }, ãˆãã¾ãˆ: { jp: "é§…å‰", en: "Front station" },
ãŠã«: { jp: "é¬¼", en: "demon" }, ã‹ã‚: { jp: "äº€", en: "Turtle" }, ãã¤ã­: { jp: "ã‚­ãƒ„ãƒ", en: "Fox" }, ãã‚‚: { jp: "é›²", en: "Cloud" },
ã‘ã‚€ã—: { jp: "æ¯›è™«", en: "Caterpillar" }, ã“ã¨ã°: { jp: "è¨€è‘‰", en: "Word" }, ã•ã‹ãª: { jp: "é­š", en: "Fish" }, ã—ãŠ: { jp: "å¡©", en: "Salt" },
ã™ãš: { jp: "éˆ´", en: "Bell" }, ã›ã¿: { jp: "ã‚»ãƒŸ", en: "Cicada" }, ãã‚‰: { jp: "ç©º", en: "Sky" }, ãŸã‘: { jp: "ç«¹", en: "Bamboo" },
ã¡ãš: { jp: "åœ°å›³", en: "Map" }, ã¤ã°ã•: { jp: "ã¤ã°ã•", en: "Wing" }, ã¦ãŒã¿: { jp: "æ‰‹ç´™", en: "Letter" }, ã¨ã‚Š: { jp: "é³¥", en: "Bird" },
ãªã¹: { jp: "é‹", en: "Pot" }, ã«ã¡ã˜ã‚‡ã†: { jp: "æ—¥å¸¸", en: "Everyday life" }, ã¬ã®: { jp: "å¸ƒ", en: "Cloth" }, ã­ã“: { jp: "çŒ«", en: "Cat" },
ã®ã‚Š: { jp: "æµ·è‹”", en: "Seaweed" }, ã¯ãª: { jp: "èŠ±", en: "Flower" }, ã²ã¤ã˜: { jp: "ç¾Š", en: "Sheep" }, ãµãã‚: { jp: "è¢‹", en: "Bag" },
ã¸ã³: { jp: "è›‡", en: "Snake" }, ã»ã—: { jp: "æ˜Ÿ", en: "Star" }, ã¾ã‚: { jp: "è±†", en: "Bean" }, ã¿ãš: { jp: "æ°´", en: "Water" },
ã‚€ã—: { jp: "è™«", en: "Insect" }, ã‚ã ã¾: { jp: "ç›®çŽ‰", en: "Eyeball" }, ã‚‚ã‚Š: { jp: "æ£®", en: "Forest" }, ã‚„ã¾: { jp: "å±±", en: "Mountain" },
ã‚†ã: { jp: "é›ª", en: "Snow" }, ã‚ˆã‚‹: { jp: "å¤œ", en: "Night" }, ã‚‰ãã : { jp: "ãƒ©ã‚¯ãƒ€", en: "Camel" }, ã‚Šã™: { jp: "ãƒªã‚¹", en: "Squirrel" },
ã‚‹ã™: { jp: "ç•™å®ˆ", en: "Absence" }, ã‚Œã„ãžã†ã“: { jp: "å†·è”µåº«", en: "Refrigerator" }, ã‚ã†ãã: { jp: "ã‚ã†ãã", en: "Candle" }, ã‚ã—ã‚‡ã: { jp: "å’Œé£Ÿ", en: "Japanese food" },
ã“ã‚Œã‚’ãã ã•ã„: { jp: "ã“ã‚Œã‚’ä¸‹ã•ã„", en: "Please give me this" }, ã‚ã‚“ã“: { jp: "ã‚ã‚“ã“", en: "Sweet red bean paste" }, ãŒã£ã“ã†: { jp: "å­¦æ ¡", en: "School" }, ãŽã‚“: { jp: "éŠ€", en: "Silver" },
ãã‚ã„: { jp: "å…·åˆ", en: "Condition" }, ã’ãŸ: { jp: "ä¸‹é§„", en: "sandals" }, ã”ã¯ã‚“: { jp: "ã”é£¯", en: "Meal" }, ã–ã£ã—: { jp: "é›‘èªŒ", en: "Magazine" },
ã˜ã¦ã‚“ã—ã‚ƒ: { jp: "è‡ªè»¢è»Š", en: "Bicycle" }, ãšã“ã†: { jp: "å›³å·¥", en: "arts and crafts" }, ãœã‚“ã¶: { jp: "å…¨éƒ¨", en: "All" }, ãžã†ãã‚“: { jp: "é›‘å·¾", en: "Cleaning cloth" },
ã ã„ã: { jp: "å¤§å·¥", en: "Carpenter" }, ã¯ãªã¢: { jp: "é¼»è¡€", en: "Nosebleed" }, ã¤ã¥ã: { jp: "ç¶šã", en: "Continuation" }, ã§ã‚“ã‚: { jp: "é›»è©±", en: "Phone" },
ã©ã‚: { jp: "æ³¥", en: "Mud" }, ã°ã‚‰: { jp: "ãƒãƒ©", en: "Rose" }, ã³ã‚‡ã†ã: { jp: "ç—…æ°—", en: "Illness" }, ã¶ã©ã†: { jp: "ã¶ã©ã†", en: "Grape" },
ã¹ã‚“ãã‚‡ã†: { jp: "å‹‰å¼·", en: "Study" }, ã¼ã†ãˆã: { jp: "è²¿æ˜“", en: "Trade" }, ã±ã¡ã‚“ã“: { jp: "ãƒ‘ãƒãƒ³ã‚³", en: "pinball game" }, ã´ã£ãŸã‚Š: { jp: "ã´ã£ãŸã‚Š", en: "Exactly" },
ã·ã‚‹ã·ã‚‹: { jp: "ãƒ—ãƒ«ãƒ—ãƒ«", en: "Quivering" }, ãºã‚“ãŽã‚“: { jp: "ãƒšãƒ³ã‚®ãƒ³", en: "Penguin" }, ã½ã‚“ãš: { jp: "ãƒãƒ³é…¢", en: "citrus sauce" }, ãã‚ƒã¹ã¤: { jp: "ã‚­ãƒ£ãƒ™ãƒ„", en: "Cabbage" },
ãã‚…ã†ã‚Š: { jp: "ãã‚…ã†ã‚Š", en: "Cucumber" }, ãã‚‡ã˜ã‚“: { jp: "å·¨äºº", en: "Giant" }, ã—ã‚ƒã‘: { jp: "é®­", en: "Salmon" }, ã—ã‚…ã‚Šã‘ã‚“: { jp: "æ‰‹è£å‰£", en: "ninja star" },
ã—ã‚‡ã†ã‚†: { jp: "é†¤æ²¹", en: "Soy sauce" }, ã¡ã‚ƒã‚ã‚“: { jp: "èŒ¶ç¢—", en: "Rice bowl" }, ã¡ã‚…ã†ã—ã‚ƒ: { jp: "æ³¨å°„", en: "Injection" }, ã¡ã‚‡ãã‚“: { jp: "è²¯é‡‘", en: "Saving money" },
ã«ã‚ƒã‚“ã“: { jp: "ã«ã‚ƒã‚“ã“", en: "Kitty" }, ã«ã‚…ã†ã„ã‚“: { jp: "å…¥é™¢", en: "Hospitalization" }, ã«ã‚‡ã‚ã«ã‚‡ã‚: { jp: "ãƒ‹ãƒ§ãƒ­ãƒ‹ãƒ§ãƒ­", en: "Wriggling" }, ã²ã‚ƒããˆã‚“: { jp: "100å††", en: "100 yen" },
ã²ã‚…ãƒ¼ã²ã‚…ãƒ¼: { jp: "ãƒ’ãƒ¥ãƒ¼ãƒ’ãƒ¥ãƒ¼", en: "whistling sound" }, ã²ã‚‡ã†ã‹: { jp: "è©•ä¾¡", en: "Evaluation" }, ã¿ã‚ƒã: { jp: "è„ˆ", en: "Pulse" }, ã¿ã‚…ãƒ¼ã˜ã£ã: { jp: "ãƒŸãƒ¥ãƒ¼ã‚¸ãƒƒã‚¯", en: "Music" },
ã¿ã‚‡ã†ã˜: { jp: "è‹—å­—", en: "Surname" }, ã‚Šã‚ƒãã”: { jp: "ç•¥èªž", en: "Abbreviation" }, ã‚Šã‚…ã†ãŒã: { jp: "ç•™å­¦", en: "Studying abroad" }, ã‚Šã‚‡ã“ã†: { jp: "æ—…è¡Œ", en: "Travel" },
ãŽã‚ƒã: { jp: "é€†", en: "Reverse" }, ãŽã‚…ã†ã«ã‚…ã†: { jp: "ç‰›ä¹³", en: "Milk" }, ãŽã‚‡ã‹ã„ã‚‹ã„: { jp: "é­šä»‹é¡ž", en: "Seafood" }, ã˜ã‚ƒãŒã„ã‚‚: { jp: "ã˜ã‚ƒãŒã„ã‚‚", en: "Potato" },
ã˜ã‚…ã†ã—ã‚‡: { jp: "ä½æ‰€", en: "Address" }, ã˜ã‚‡ã›ã„: { jp: "å¥³æ€§", en: "Woman" }, ã³ã‚ƒãã‚„: { jp: "ç™½å¤œ", en: "Midnight sun" }, ã³ã‚…ãƒ¼ã¦ãƒãµã‚‹: { jp: "ãƒ“ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ•ãƒ«", en: "Beautiful" },
ã³ã‚‡ã†ã: { jp: "ç—…æ°—", en: "Illness" }, ã´ã‚ƒã£ã´ã‚ƒ: { jp: "ã´ã‚ƒ", en: "squishy step" }, ã´ã‚…ãƒ¼ã´ã‚…ãƒ¼: { jp: "ãƒ”ãƒ¥ãƒ¼ãƒ”ãƒ¥ãƒ¼", en: "Whistling sound" }, ã´ã‚‡ã‚“ã´ã‚‡ã‚“: { jp: "ã´ã‚‡ã‚“ã´ã‚‡ã‚“", en: "Hopping" }
  };

  let currentHiragana = "";
  let correctAnswer = "";
  let correctCount = 0;
  let wrongCount = 0;
  const totalHiragana = Object.keys(hiraganaList).length;

  let wrongHiragana = [];
  let allAnswered = new Set();

  function getRandomHiragana() {
    const unansweredHiragana = Object.keys(hiraganaList).filter(hiragana => !allAnswered.has(hiragana));
    if (unansweredHiragana.length === 0) {
      return wrongHiragana[Math.floor(Math.random() * wrongHiragana.length)];
    }
    return unansweredHiragana[Math.floor(Math.random() * unansweredHiragana.length)];
  }

  function displayHiragana() {
    currentHiragana = getRandomHiragana();
    correctAnswer = hiraganaList[currentHiragana];
    document.getElementById("hiragana").innerText = `${currentHiragana} (${hiraganaList[currentHiragana].en})`;
    document.getElementById("userInput").value = '';
    document.getElementById("result").innerText = '';
    updateRemainingCount();
  }

  function checkAnswer() {
  const userAnswer = document.getElementById("userInput").value.trim();
  if (correctAnswer.jp === userAnswer) {  // ç­”ãˆãŒæ¼¢å­—ï¼ˆjpï¼‰ã¨ä¸€è‡´ã™ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
    correctCount++;
    document.getElementById("result").innerText = "Correct! ðŸŽ‰";
    document.getElementById("result").style.color = "green";
    allAnswered.add(currentHiragana);
    const index = wrongHiragana.indexOf(currentHiragana);
    if (index !== -1) {
      wrongHiragana.splice(index, 1);
    }
  } else {
    document.getElementById("result").innerText = "Try again! âŒ";
    document.getElementById("result").style.color = "red";
    wrongCount++;
    if (!wrongHiragana.includes(currentHiragana)) {
      wrongHiragana.push(currentHiragana);
    }
  }
  setTimeout(displayHiragana, 1000);  // æ¬¡ã®ã²ã‚‰ãŒãªã‚’1ç§’å¾Œã«è¡¨ç¤º
}


  function startRecognition() {
    if (!("SpeechRecognition" in window || "webkitSpeechRecognition" in window)) {
      alert("Your browser does not support voice recognition.");
      return;
    }

    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = 'ja-JP';

    recognition.onresult = (event) => {
      const spokenText = event.results[0][0].transcript.trim();
      document.getElementById("userInput").value = spokenText;
      checkAnswer();
    };

    recognition.onerror = (event) => {
      console.error('Recognition error:', event.error);
      document.getElementById("result").innerText = "Recognition failed. Please try again.";
      document.getElementById("result").style.color = "red";
    };

    recognition.start();
  }

  function updateRemainingCount() {
    const remaining = totalHiragana - correctCount;
    document.getElementById("remainingCount").innerText = `Remaining: ${remaining} Hiragana`;

    if (remaining <= 0) {
      document.getElementById("remainingCount").style.display = 'none';
      document.getElementById("finalResult").innerText = `You finished the game! ðŸŽ‰`;
      document.getElementById("finalResult").style.color = correctCount === totalHiragana ? 'green' : 'red';
      document.getElementById("result").style.display = 'none';
      document.getElementById("userInput").disabled = true;
    }
  }

  function restartGame() {
    correctCount = 0;
    wrongCount = 0;
    wrongHiragana = [];
    allAnswered.clear();
    document.getElementById("finalResult").innerText = "";
    document.getElementById("remainingCount").style.display = 'block';
    document.getElementById("result").style.display = 'block';
    document.getElementById("userInput").disabled = false;
    displayHiragana();
  }

  displayHiragana();

  document.getElementById("userInput").addEventListener("keydown", function(event) {
    if (event.key === "Enter") {
      checkAnswer();
    }
  });
  document.getElementById("startRecognition").addEventListener("click", startRecognition);
  document.getElementById("restartButton").addEventListener("click", restartGame);

  if (localStorage.getItem('darkMode') === 'true') {
    document.body.classList.add('dark-mode');
  }
</script>
</body>
</html>
